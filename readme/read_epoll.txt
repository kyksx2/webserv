GESTION DES EVENNEMENTS DU SERVEUR

***EPOLL***
https://man7.org/linux/man-pages/man7/epoll.7.html
mecanisme Linux qui permet de gerer simultanement beaucoup de sockets
sans blocage.
detecte uniquement quand un FD est pret a lire/ecrire.

-- 3 FONCTIONS DE BASE --

-- creation du "contexte":
https://man7.org/linux/man-pages/man2/epoll_create.2.html

int epoll_create(int size)
!! size est obsolete mais doit etre > 0 !!
retourne un fd surveille

en cas d'echec return -1.

-- Ajoute / modifie / retire un FD surveille:
https://man7.org/linux/man-pages/man2/epoll_ctl.2.html

int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)
 - epfd = fd renvoyer par epoll_create()
 - op(operation) = regle sur ajouter, modifier ou retirer -> voir le MAN
 - fd = fd du socket(serveur ou client)
 - *event = structure contenent les flags et le fd a identifier.

-- structure event:
https://man7.org/linux/man-pages/man3/epoll_event.3type.html
garde la data du fd concerne a surveiller

struct epoll_event {
    uint32_t      events;  --> event a surveiller
    epoll_data_t  data;    --> structure ci dessous
};

union epoll_data {
    void     *ptr;
    int       fd; --> fd a surveiller
    uint32_t  u32;
    uint64_t  u64;
};

-- attente sur epoll:
https://man7.org/linux/man-pages/man2/epoll_wait.2.html

int epoll_wait(int epfd, struct epoll_event *events, int maxevents,
                int timeout)
 - events = tableau rempli par epoll
 - maxevents = taille du tableau
 - timeout = savoir le temps d'attente

retourne le nombre d'evenements prets
events[i].data.fd = fd a traiter

--- FLAG EPOLL ---
EPOLLIN (descripteur pret a etre lu):
1. pour la socket d'ecoute: indique une nouvelle connection en attente (->accept()).
2. pour un socket client: indique des donnees arrivees du client (-> recv()).

EPOLLOUT (descripteur pret pour ecriture):
pour un socket client: buffer d'envoi vide, on peut envoyer des donnees (->send())

EPOLLERR (condition d'erreur survenue):

EPOLLHUP (deconnexion arrive):
indique que le cote oppose a ferme la connection